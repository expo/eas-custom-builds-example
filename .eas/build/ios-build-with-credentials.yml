# this config is executed when running a build with `ios-build-with-credentials` profile
# check the profile's configuration in eas.json to see what are the settings needed to execute it properly

build:
  name: iOS build with credentials build as executed by the eas/build command
  steps:
    # all of these steps can be replaced by the single
    # - eas/build
    # call
    # this example aims to show what steps are executed under the hood
    # it can be useful to know it if somebody wants to alter and customize the default build process

    - eas/checkout

    - eas/install_node_modules

    - eas/get_credentials_for_build_triggered_by_github_integration

    - eas/resolve_apple_team_id_from_credentials:
        inputs:
          id: resolve_apple_team_id_from_credentials

    - eas/prebuild:
        inputs:
          apple_team_id: ${ steps.resolve_apple_team_id_from_credentials.apple_team_id }

    - run:
        name: Install pods
        working_directory: ./ios
        command: pod install

    - eas/configure_eas_update:
        inputs:
          throw_if_not_configured: false

    - eas/configure_ios_credentials

    - eas/configure_ios_version

    - eas/generate_gymfile_from_template:
        inputs:
          credentials: ${ eas.job.secrets.buildCredentials }

    - eas/run_fastlane

    - eas/find_and_upload_build_artifacts
